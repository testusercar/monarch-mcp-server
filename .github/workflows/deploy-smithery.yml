name: Validate for Render

on:
  push:
    branches:
      - main
      - master
  workflow_dispatch:

jobs:
  validate:
    name: Validate Setup
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install -e .

      - name: Validate pyproject.toml
        run: |
          pip install tomli || pip install tomllib 2>/dev/null || true
          python -c "
          try:
              import tomli as tomllib
          except ImportError:
              import tomllib
          with open('pyproject.toml', 'rb') as f:
              config = tomllib.load(f)
              print('‚úì pyproject.toml is valid')
          "

      - name: Validate render.yaml
        run: |
          if [ -f render.yaml ]; then
            echo "‚úì render.yaml exists"
          else
            echo "‚ùå render.yaml not found"
            exit 1
          fi

      - name: Test server import
        run: |
          python -c "import sys; sys.path.insert(0, 'src'); from monarch_mcp_server.server import create_server; print('‚úì Server imports successfully')"

      - name: Deployment Notes
        run: |
          echo "‚úì Repository is ready for Render deployment"
          echo "üìã Next steps:"
          echo "  1. Connect your GitHub repository to Render: https://render.com"
          echo "  2. Create a new Web Service in Render"
          echo "  3. Select this repository"
          echo "  4. Render will auto-detect render.yaml configuration"
          echo "  5. Set environment variables in Render dashboard:"
          echo "     - MONARCH_EMAIL"
          echo "     - MONARCH_PASSWORD"
          echo "     - MONARCH_MFA_CODE (optional)"
          echo "  6. Deploy!"
